<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆãƒ‡ãƒãƒƒã‚°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            height: 80px;
            resize: vertical;
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-secondary {
            background: #6c757d;
        }
        .btn-secondary:hover {
            background: #545b62;
        }
        .debug-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
    
    <div id="status-container"></div>
    
    <form id="debug-form">
        <div class="form-group">
            <label for="project-name">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå *</label>
            <input type="text" id="project-name" value="ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ" required>
        </div>
        
        <div class="form-group">
            <label for="project-description">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ *</label>
            <textarea id="project-description" required>ã“ã‚Œã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæ©Ÿèƒ½ã®ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚</textarea>
        </div>
        
        <div class="form-group">
            <label for="project-budget">äºˆç®—ï¼ˆä¸‡å††ï¼‰</label>
            <input type="number" id="project-budget" value="1000">
        </div>
        
        <div class="form-group">
            <label for="project-duration">æœŸé–“ï¼ˆãƒ¶æœˆï¼‰</label>
            <input type="number" id="project-duration" value="12">
        </div>
        
        <div class="form-group">
            <label for="research-requirements">ç ”ç©¶è€…ã¸ã®è¦ä»¶</label>
            <textarea id="research-requirements">AIãƒ»æ©Ÿæ¢°å­¦ç¿’ã®å°‚é–€çŸ¥è­˜</textarea>
        </div>
        
        <div class="form-group">
            <label for="project-keywords">é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
            <input type="text" id="project-keywords" value="AI, æ©Ÿæ¢°å­¦ç¿’, ãƒ†ã‚¹ãƒˆ">
        </div>
        
        <button type="button" class="btn" onclick="testLocalStorage()">ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ</button>
        <button type="button" class="btn" onclick="testProjectManager()">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ†ã‚¹ãƒˆ</button>
        <button type="button" class="btn" onclick="testAPIConnection()">APIæ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
        <button type="button" class="btn btn-secondary" onclick="clearLocalStorage()">ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒªã‚¢</button>
        <button type="button" class="btn btn-secondary" onclick="showLocalStorage()">ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¡¨ç¤º</button>
    </form>
    
    <div id="debug-log" class="debug-log">ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...\n</div>
    
    <script src="config.js"></script>
    <script src="api-client.js"></script>
    <script src="js/project-manager.js"></script>
    <script>
        function log(message) {
            const debugLog = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.textContent += `[${timestamp}] ${message}\n`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message);
        }
        
        function showStatus(message, type = 'info') {
            const container = document.getElementById('status-container');
            container.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®ãƒã‚§ãƒƒã‚¯
        document.addEventListener('DOMContentLoaded', function() {
            log('=== ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«é–‹å§‹ ===');
            log('config.jsèª­ã¿è¾¼ã¿çŠ¶æ³: ' + (typeof config !== 'undefined' ? 'âœ…' : 'âŒ'));
            log('api-client.jsèª­ã¿è¾¼ã¿çŠ¶æ³: ' + (typeof apiClient !== 'undefined' ? 'âœ…' : 'âŒ'));
            log('project-manager.jsèª­ã¿è¾¼ã¿çŠ¶æ³: ' + (typeof window.projectManager !== 'undefined' ? 'âœ…' : 'âŒ'));
            log('localStorageåˆ©ç”¨å¯èƒ½: ' + (typeof Storage !== 'undefined' ? 'âœ…' : 'âŒ'));
            
            if (typeof window.projectManager !== 'undefined') {
                log('ProjectManageråˆæœŸåŒ–çŠ¶æ³: âœ…');
            } else {
                log('ProjectManageråˆæœŸåŒ–çŠ¶æ³: âŒ - æ‰‹å‹•åˆæœŸåŒ–è©¦è¡Œä¸­...');
                try {
                    window.projectManager = new ProjectManager();
                    log('ProjectManageræ‰‹å‹•åˆæœŸåŒ–: âœ…');
                } catch (error) {
                    log('ProjectManageræ‰‹å‹•åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ' + error.message);
                }
            }
        });
        
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
        function testLocalStorage() {
            log('=== ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            try {
                // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä¿å­˜
                const testData = { test: 'value', timestamp: Date.now() };
                localStorage.setItem('test-project', JSON.stringify(testData));
                log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¿å­˜: âœ…');
                
                // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
                const loaded = JSON.parse(localStorage.getItem('test-project'));
                log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸èª­ã¿è¾¼ã¿: âœ… ' + JSON.stringify(loaded));
                
                // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å‰Šé™¤
                localStorage.removeItem('test-project');
                log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å‰Šé™¤: âœ…');
                
                showStatus('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆå®Œäº† âœ…', 'success');
                
            } catch (error) {
                log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ' + error.message);
                showStatus('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆå¤±æ•— âŒ: ' + error.message, 'error');
            }
        }
        
        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ†ã‚¹ãƒˆ
        async function testProjectManager() {
            log('=== ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            if (!window.projectManager) {
                log('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                showStatus('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ âŒ', 'error');
                return;
            }
            
            try {
                // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—
                const formData = {
                    name: document.getElementById('project-name').value,
                    description: document.getElementById('project-description').value,
                    budget: document.getElementById('project-budget').value,
                    duration: document.getElementById('project-duration').value,
                    requirements: document.getElementById('research-requirements').value,
                    keywords: document.getElementById('project-keywords').value
                };
                
                log('ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿: ' + JSON.stringify(formData, null, 2));
                
                // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆå®Ÿè¡Œ
                showStatus('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆä¸­...', 'info');
                const result = await window.projectManager.createTempProject(formData);
                
                log('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆçµæœ: ' + JSON.stringify(result, null, 2));
                
                if (result && result.id) {
                    showStatus('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæˆåŠŸ âœ… ID: ' + result.id, 'success');
                    
                    // ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’ç¢ºèª
                    const projects = window.projectManager.getTempProjectsLocal();
                    log('ä¿å­˜æ¸ˆã¿ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°: ' + projects.length);
                    projects.forEach((project, index) => {
                        log(`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ${index + 1}: ${project.name} (${project.id})`);
                    });
                } else {
                    showStatus('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆå¤±æ•— âŒ', 'error');
                }
                
            } catch (error) {
                log('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ' + error.message);
                log('ã‚¨ãƒ©ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯: ' + error.stack);
                showStatus('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã‚¨ãƒ©ãƒ¼ âŒ: ' + error.message, 'error');
            }
        }
        
        // APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
        async function testAPIConnection() {
            log('=== APIæ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            if (!window.apiClient) {
                log('APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                showStatus('APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ âŒ', 'error');
                return;
            }
            
            try {
                showStatus('APIæ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...', 'info');
                
                // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
                log('ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œä¸­...');
                const healthResult = await window.apiClient.healthCheck();
                log('ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çµæœ: ' + JSON.stringify(healthResult, null, 2));
                
                // ç°¡æ˜“æ¥ç¶šãƒ†ã‚¹ãƒˆ
                log('ç°¡æ˜“æ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...');
                const connectionResult = await window.apiClient.simpleConnectionTest();
                log('ç°¡æ˜“æ¥ç¶šãƒ†ã‚¹ãƒˆçµæœ: ' + JSON.stringify(connectionResult, null, 2));
                
                if (connectionResult.status === 'success') {
                    showStatus('APIæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ âœ…', 'success');
                } else {
                    showStatus('APIæ¥ç¶šãƒ†ã‚¹ãƒˆå¤±æ•— âŒ: ' + connectionResult.message, 'error');
                }
                
            } catch (error) {
                log('APIæ¥ç¶šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ' + error.message);
                showStatus('APIæ¥ç¶šã‚¨ãƒ©ãƒ¼ âŒ: ' + error.message, 'error');
            }
        }
        
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒªã‚¢
        function clearLocalStorage() {
            try {
                localStorage.removeItem('tempProjects');
                localStorage.removeItem('projectDraft');
                localStorage.removeItem('current_user_id');
                log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
                showStatus('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒªã‚¢å®Œäº† âœ…', 'success');
            } catch (error) {
                log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼: ' + error.message);
                showStatus('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒªã‚¢å¤±æ•— âŒ', 'error');
            }
        }
        
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¡¨ç¤º
        function showLocalStorage() {
            log('=== ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å†…å®¹ ===');
            
            try {
                const tempProjects = localStorage.getItem('tempProjects');
                const projectDraft = localStorage.getItem('projectDraft');
                const userId = localStorage.getItem('current_user_id');
                
                log('tempProjects: ' + (tempProjects || '(ãªã—)'));
                log('projectDraft: ' + (projectDraft || '(ãªã—)'));
                log('current_user_id: ' + (userId || '(ãªã—)'));
                
                if (tempProjects) {
                    const projects = JSON.parse(tempProjects);
                    log('ä¿å­˜æ¸ˆã¿ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°: ' + projects.length);
                    projects.forEach((project, index) => {
                        log(`  ${index + 1}. ${project.name} (${project.id}) - ${project.status}`);
                    });
                }
                
                showStatus('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å†…å®¹ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ', 'info');
                
            } catch (error) {
                log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒ©ãƒ¼: ' + error.message);
                showStatus('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒ©ãƒ¼ âŒ', 'error');
            }
        }
    </script>
</body>
</html>